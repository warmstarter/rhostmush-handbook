<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.16 -->
<document source="/home/pi/rhostmush/rhostmush-handbook/source/maintenance.rst">
    <section ids="maintenance" names="maintenance">
        <title>Maintenance</title>
        <section ids="signals-and-why-you-need-them-for-control" names="signals\ and\ why\ you\ need\ them\ for\ control">
            <title>Signals and why you need them for control</title>
            <paragraph>Rhost by default allows signals at the shell to handle various processes in-game.</paragraph>
            <paragraph>The following signals are useful.</paragraph>
            <section ids="term-kill-term-or-kill-15" names="term\ (kill\ -term\ or\ kill\ -15)">
                <title>TERM (kill -TERM or kill -15)</title>
                <block_quote>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>This will immediately terminate the mush, dumping a special flatfile called
                                netrhost.db.TERM and scramming the db in question by force-closing it
                                without any writes.  A TERM is the effort for the mush to shut down the
                                mush as fast as possible to avoid any db corruption if possible since
                                a TERM signal is common during a server shutdown, so time is paramount.</paragraph>
                        </list_item>
                    </bullet_list>
                </block_quote>
            </section>
            <section ids="usr1-kill-usr1" names="usr1\ (kill\ -usr1)">
                <title>USR1 (kill -USR1)</title>
                <block_quote>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>This by default issues a reboot on the server.  This is a special parameter
                                because this can actually be changed in-game to do any number of other
                                things.  Please refer to the RhostMUSH running in question if this is
                                the default behavior or if the method for USR1 is doing something else.</paragraph>
                        </list_item>
                    </bullet_list>
                </block_quote>
            </section>
            <section ids="usr2-kill-usr2" names="usr2\ (kill\ -usr2)">
                <title>USR2 (kill -USR2)</title>
                <block_quote>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>This will shutdown (cleanly) the mush.  This behaves as if you issued
                                a @shutdown from within the game, and follows all proper procedure
                                in bringing the game down cleanly and safely.  This shoudl be used
                                when doing maintenance on the game or if you need to bring it down
                                from the shell.</paragraph>
                        </list_item>
                    </bullet_list>
                </block_quote>
            </section>
            <section ids="kill-kill-kill-or-kill-9" names="kill\ (kill\ -kill\ or\ kill\ -9)">
                <title>KILL (kill -KILL or kill -9)</title>
                <block_quote>
                    <bullet_list bullet="-">
                        <list_item>
                            <paragraph>This signal can not be caught and will immediately terminate the game
                                without any safty to the database at all.  Short of something horribly
                                wrong going on, this should never be used to bring down your mush.
                                Doing so will almost certainly corrupt your databases (ALL OF THEM)
                                that are open, including but not limited to your main database, your
                                mail database, your autoregistration database, and so forth.  So if
                                you do this, plan to do some database recovery from your flat files.
                                Also, when you bring down a mush in this manner, you need to issue
                                Startmush -f to bring it back up.</paragraph>
                        </list_item>
                    </bullet_list>
                </block_quote>
            </section>
        </section>
        <section ids="shutting-down-gracefully" names="shutting\ down\ gracefully">
            <title>Shutting down gracefully</title>
            <section ids="rhostmush-has-many-ways-to-shut-down-the-game-cleanly" names="rhostmush\ has\ many\ ways\ to\ shut\ down\ the\ game\ cleanly">
                <title>Rhostmush has many ways to shut down the game cleanly</title>
                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                    <list_item>
                        <paragraph>Log into the mush and issue @shutdown</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Issue a kill -USR2 to the mush which issues an emergency @shutdown</paragraph>
                    </list_item>
                    <list_item>
                        <paragraph>Issue a kill -TERM to the mush which issues an emergency abort and clean shutdown.</paragraph>
                    </list_item>
                </enumerated_list>
            </section>
            <section ids="warning-never-kill-9-rhost" names="warning:\ never\ kill\ -9\ rhost">
                <title>WARNING: Never kill -9 Rhost</title>
                <paragraph>Under NO CIRCUMSTANCES should you kill -9 your mush unless you don’t care for the
                    database.  The reason is if the mush happens to be saving, in any method, to the
                    database, especially a QDBM database, you will likely have just corrupted your
                    database, so pull out a flatfile to recover.</paragraph>
                <paragraph>Sadly, this also may occur if the server hosting you takes a nose-dive in the middle
                    of a db write.  Rhost can recover corruption in-game while up, but if it bombs
                    in the middle of a write, all bets are off. :)</paragraph>
            </section>
        </section>
        <section ids="autoshutdown-script" names="autoshutdown\ script">
            <title>Autoshutdown script</title>
            <paragraph>The makefile will ‘make’ the program that will STOP the mush.
                Please tweek ‘autolog.h’ with the proper parameters.</paragraph>
            <paragraph>The ‘startup.sh’ will START the mush.</paragraph>
            <paragraph>Both of these are intended to be used for automations (automated processes)
                like your rc.local file and/or startup scripts when you bring your server up.</paragraph>
        </section>
        <section ids="network-port-redirector" names="network\ port\ redirector">
            <title>Network Port redirector</title>
            <paragraph>This is a port redirector incase you decide to move your mush
                to a new site/port.  To use, first, compile the code.  To do
                this you would type the following:</paragraph>
            <block_quote>
                <paragraph>cc portmsg.c -o portmsg</paragraph>
            </block_quote>
            <paragraph>if ‘cc’ is not defined, try the following:</paragraph>
            <block_quote>
                <paragraph>gcc portmsg.c -o portmsg</paragraph>
            </block_quote>
            <paragraph>Once compiled, you would then modify the file ‘file’ to describe
                the mush, what was done, where it’s moved to, then specify the
                IP address and the PORT where specified.</paragraph>
            <paragraph>To launch the application, you would then type:</paragraph>
            <block_quote>
                <paragraph>./portmsg file &lt;port&gt;</paragraph>
            </block_quote>
            <paragraph>Where &lt;port&gt; is the port where the mush used to run at.</paragraph>
        </section>
        <section ids="using-the-built-in-cron-system-for-periodically-running-commands" names="using\ the\ built-in\ cron\ system\ for\ periodically\ running\ commands">
            <title>Using the built-in cron system for periodically running commands</title>
            <section ids="syntax-for-rhost-cron" names="syntax\ for\ rhost.cron">
                <title>Syntax for rhost.cron</title>
                <paragraph>The rhost.cron file will be in the syntax as follows:</paragraph>
                <paragraph>username (or dbref#)
                    command1;command2;command3;…;commandN
                    command
                    command
                    command1;command2;command3;…;commandN</paragraph>
                <paragraph>You can have commands strung together with a semicolon
                    on the same line.  This counts as a single line of input.
                    You can have at most 20 lines of commands after the target
                    you wish to execute the commands as.  The target may
                    be a player name OR a dbref# of any valid dbref# within
                    the game.  Invalid targets will abort the cron process.
                    Non-printable characters in the cron file will abort
                    the process.  Any aborts or warnings will be logged
                    in the netrhost.gamelog.</paragraph>
                <paragraph>Here is a working example of the code cron file.
                    This example will perform dumps of the mush.</paragraph>
            </section>
            <section ids="example-syntaxt-for-rhost-cron" names="example\ syntaxt\ for\ rhost.cron">
                <title>Example syntaxt for rhost.cron</title>
                <paragraph>#1
                    @dump/flat; @@ dump the main game database to flatfile
                    wmail/unload; @@ dump the mail database to flatfile
                    @areg/unload; @@ dump the registration database to flatfile
                    newsdb/unload; @@ dump the news bbs database to flatfile</paragraph>
            </section>
        </section>
        <section ids="the-following-scripts-are-used-in-the-game-directory" names="the\ following\ scripts\ are\ used\ in\ the\ game\ directory">
            <title>The following scripts are used in the game directory</title>
            <paragraph>Startmush               – used to Start up the mush
                backup_flat.sh          – Used to run backups with @dump/flat within the game</paragraph>
            <block_quote>
                <paragraph>(Started with Startmush automatically)</paragraph>
            </block_quote>
            <paragraph>backup_restart.sh       – Restart the backup_flat.sh if changes are done
                compress_logs.sh        – Compress logs in ‘oldlogs’.  Ran with Startmush
                findit.sh               – Internal script used to check for flatfile validity
                mailhide.sh             – Wrapper to hide from address using the ‘mail’ progam
                minimal.sh              – Auto-load the minimal db into the mush
                proxysnarf.sha          – Internal script for the tor_pull.sh tor proxy blacklist
                tor_pullit.sh           – Internal script for the tor_pull.sh for proxy blacklist
                recovery.sh             – If your db is corrupt, run this to auto-revert to an</paragraph>
            <block_quote>
                <paragraph>earlier flatfile</paragraph>
            </block_quote>
            <definition_list>
                <definition_list_item>
                    <term>tor_pull.sh             – Create a blacklist.txt file that can be loaded via the</term>
                    <definition>
                        <paragraph>internal @blacklist command for proxy handling</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
        </section>
        <section ids="textfiles-for-rhostmush" names="textfiles\ for\ rhostmush">
            <title>Textfiles for RhostMUSH</title>
            <definition_list>
                <definition_list_item>
                    <term>areghost.txt           - file player gets when autoregistration on registered</term>
                    <definition>
                        <paragraph>host.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>autoreg.txt            - file player gets when autoregistration on</term>
                    <definition>
                        <paragraph>non-registered host.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>autoreg_include.txt    - file player receives in email when they autoregister</term>
                    <definition>
                        <paragraph>attached to login/passwd</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
            <paragraph>badsite.txt            - file player gets when site is not allowed.
                connect.txt            - file player gets when connect
                create_reg.txt         - file player gets when their site is register and they</paragraph>
            <block_quote>
                <paragraph>can’t create.</paragraph>
            </block_quote>
            <definition_list>
                <definition_list_item>
                    <term>doorconf.txt           - file that is searched for information regarding @door.</term>
                    <definition>
                        <paragraph><emphasis>NOTE</emphasis>  Need to mkindx doorconf.txt doorconf.indx for this file</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>down.txt               - file player gets when the mush has logins disabled</term>
                    <definition>
                        <paragraph>(@disable login)</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>error.txt              - the ‘Huh? (type help for help)’ messages.</term>
                    <definition>
                        <paragraph><emphasis>NOTE</emphasis>  Need to mkindx error.txt error.indx for this file</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>full.txt               - file player gets when the mush can’t have any more</term>
                    <definition>
                        <paragraph>players.</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
            <paragraph>guest.txt              - file player gets when they connect as a guest.
                help.txt               - your help file</paragraph>
            <block_quote>
                <paragraph><emphasis>NOTE</emphasis>  Need to mkindx help.txt help.indx for this file</paragraph>
            </block_quote>
            <paragraph>motd.txt               - your motd file
                news.txt               - your news file</paragraph>
            <block_quote>
                <paragraph><emphasis>NOTE</emphasis>  Need to mkindx news.txt news.indx for this file</paragraph>
            </block_quote>
            <definition_list>
                <definition_list_item>
                    <term>newuser.txt            - file newly created players get when they connect for</term>
                    <definition>
                        <paragraph>the first time.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>noguest.txt            - file player gets when they are not allowed to connect</term>
                    <definition>
                        <paragraph>to a guest.</paragraph>
                    </definition>
                </definition_list_item>
                <definition_list_item>
                    <term>plushelp.txt           - optional +help file. (needs compile time option)</term>
                    <definition>
                        <paragraph><emphasis>NOTE</emphasis>  Need to mkindx plushelp.txt plushelp.indx for this file</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
            <paragraph>quit.txt               - file player gets when they disconnect.
                register.txt           - file player gets when the site is locked down for</paragraph>
            <block_quote>
                <paragraph>registration.</paragraph>
            </block_quote>
            <definition_list>
                <definition_list_item>
                    <term>wizhelp.txt            - your wizhelp file</term>
                    <definition>
                        <paragraph><emphasis>NOTE</emphasis>  Need to mkindx wizhelp.txt wizhelp.indx for this file</paragraph>
                    </definition>
                </definition_list_item>
            </definition_list>
            <paragraph>wizmotd.txt            - your wiz motd file</paragraph>
            <section ids="textfile-frequently-asked-questions" names="textfile\ frequently\ asked\ questions">
                <title>Textfile Frequently Asked Questions</title>
                <paragraph>Q:  How do I put color in these files?
                    A1: Look at ansi.h and you need to put the literal ASCII codes.</paragraph>
                <block_quote>
                    <paragraph>They will look like: ^[[0m (for ANSI_NORMAL).  That’s &lt;ESC&gt;[</paragraph>
                </block_quote>
                <definition_list>
                    <definition_list_item>
                        <term>A2: You can enable ansi_txtfiles then use %c (or %x/%m) encoding</term>
                        <definition>
                            <paragraph>for ansi, however you compiled your Rhost.</paragraph>
                        </definition>
                    </definition_list_item>
                </definition_list>
                <paragraph>Q:  I want to design my own txt files to read in the mush.
                    A:  Easy.  Design them like help.txt would be set up, mkindx the file,</paragraph>
                <block_quote>
                    <paragraph>then you can access it via @dynhelp online.</paragraph>
                </block_quote>
                <paragraph>Q:  Do I have to mkindx these files whenever I make changes?
                    A:  Only the ones that have ‘&amp; ‘ index. (help.txt, wizhelp.txt, news.txt, etc)</paragraph>
                <paragraph>Q:  Do I have to @readcache in the game whenever I make a change?
                    A:  Only when you modify any of the files listed in README.TXTFILES.  Not the ones</paragraph>
                <block_quote>
                    <paragraph>you use with @dynhelp.</paragraph>
                </block_quote>
                <paragraph>Q:  Can’t I just make code in the mush that then is used for these silly txt files?
                    A:  Absolutely.  Check ‘wizhelp file_object’.</paragraph>
            </section>
        </section>
    </section>
</document>
