<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE document PUBLIC "+//IDN docutils.sourceforge.net//DTD Docutils Generic//EN//XML" "http://docutils.sourceforge.net/docs/ref/docutils.dtd">
<!-- Generated by Docutils 0.16 -->
<document source="/home/pi/rhostmush/rhostmush-handbook/source/utilities/ssl.rst">
    <substitution_definition names="br"><raw format="html .. force a line break in html output (blank lines needed here)" xml:space="preserve">&lt;br /&gt;</raw></substitution_definition>
    <substitution_definition names="p"><raw format="html .. force a blank line in html output (blank lines needed here)" xml:space="preserve">&lt;p&gt;&lt;/p&gt;</raw></substitution_definition>
    <comment xml:space="preserve">These are replacement strings for non-ASCII characters used within the project
using the same name as the html entity names (e.g., &amp;copy;) for that character</comment>
    <substitution_definition ltrim="1" names="copy">©</substitution_definition>
    <substitution_definition ltrim="1" names="trade">™</substitution_definition>
    <substitution_definition ltrim="1" names="reg">®</substitution_definition>
    <substitution_definition ltrim="1" names="deg">°</substitution_definition>
    <substitution_definition names="plusminus" rtrim="1">±</substitution_definition>
    <substitution_definition names="micro" rtrim="1">µ</substitution_definition>
    <substitution_definition ltrim="1" names="sup2">²</substitution_definition>
    <target ids="utilities-ssl" names="utilities-ssl"></target>
    <index entries="['single',\ 'Utilities\ -\ SSL',\ 'index-0',\ '',\ None] ['single',\ 'SSL\ -\ Utilities',\ 'index-0',\ '',\ None]" inline="False"></index>
    <target refid="index-0"></target>
    <section ids="setting-up-an-ssl-tunnel-for-secure-connection-options index-0" names="setting\ up\ an\ ssl\ tunnel\ for\ secure\ connection\ options">
        <title>Setting up an SSL tunnel for secure connection options</title>
        <section ids="quickstart-for-ssl-setup-with-stunnel" names="quickstart\ for\ ssl\ setup\ with\ stunnel">
            <title>Quickstart for SSL setup with stunnel</title>
            <enumerated_list enumtype="arabic" prefix="" suffix=".">
                <list_item>
                    <paragraph>Modify your netrhost.conf file and add/change the following parameters:</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>sconnect_reip 1</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>sconnect_cmd SECRET-MAGIC-COOKIE</paragraph>
                            <block_quote>
                                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                                    <list_item>
                                        <paragraph>SECRET-MAGIC-COOKIE is a case sensitive single word phrase. Any printable character other than the '#' character is allowable.  You may use up to 30 characters.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>Make sure the secret is a hard to guess phrase.  This is used by stunnel to forward on the originating IP address.</paragraph>
                                    </list_item>
                                </enumerated_list>
                            </block_quote>
                        </list_item>
                        <list_item>
                            <paragraph>sconnect_host localhost 127.0.0.1 othersite.goes.here</paragraph>
                            <block_quote>
                                <enumerated_list enumtype="arabic" prefix="" suffix=".">
                                    <list_item>
                                        <paragraph>This is optional.</paragraph>
                                    </list_item>
                                    <list_item>
                                        <paragraph>If you do not specify it it defaults to 'localhost 127.0.0.1'.  If your domain has a unique name like 'localhost.localdomain' like some ubuntu distributions, then you should customize your stunnel_host.</paragraph>
                                    </list_item>
                                </enumerated_list>
                            </block_quote>
                        </list_item>
                    </enumerated_list>
                </list_item>
                <list_item>
                    <paragraph>go into the stunnel directory</paragraph>
                </list_item>
                <list_item>
                    <paragraph>./stunnel_setup.sh</paragraph>
                    <enumerated_list enumtype="arabic" prefix="" suffix=".">
                        <list_item>
                            <paragraph>Choose the defaults or alter them based on preferences</paragraph>
                        </list_item>
                        <list_item>
                            <paragraph>Make sure to choose the warpbubble conf file</paragraph>
                        </list_item>
                    </enumerated_list>
                </list_item>
                <list_item>
                    <paragraph>./stunnel_start.sh</paragraph>
                </list_item>
                <list_item>
                    <paragraph>Use ./stunnel_stop.sh to stop the SSL tunnel at any time</paragraph>
                </list_item>
            </enumerated_list>
            <paragraph>You do not need to shutdown the ssl handler if you shutdown the mush.  They
                are entirely separate processes.</paragraph>
        </section>
        <section ids="detailed-ssl-setup-with-stunnel" names="detailed\ ssl\ setup\ with\ stunnel">
            <title>Detailed SSL setup with stunnel</title>
            <paragraph>To setup SSL connectivity, we use the STUNNEL application to tunnel SSL to
                the mush.  This acts a bit like a man in the middle but remains controlled
                by the game owner which would have access to the end point anyway.</paragraph>
            <note>
                <paragraph>it is assumed you will have already initially set up your netrhost.conf.</paragraph>
            </note>
            <section ids="stunnel-directory" names="stunnel\ directory">
                <title>stunnel directory</title>
                <paragraph>You would set up the stunnel from the 'stunnel' directory.  There the following
                    files are of relevance:</paragraph>
                <literal_block force="False" language="default" linenos="False" xml:space="preserve">README                     -- a readme explaining the points of stunnel
stunnel.conf.example       -- The example stunnel.conf file.  If you wish to create this manually you're welcome to.  Just make sure the end file is stunnel.conf
stunnel_setup.sh           -- the script to build a stunnel.conf file for you which will be dropped at your specified location.
stunnel_kill.sh            -- Stop/terminate the stunnel process.
stunnel_start.sh           -- Start the stunnel process.
warpbubble.pl              -- the perl script that handles stunnel to mush connectivity.
stunnel_src                -- If you do not have stunnel, this directory will allow you to download, compile and locally install.</literal_block>
            </section>
            <section ids="modifying-netrhost-conf" names="modifying\ netrhost.conf">
                <title>Modifying netrhost.conf</title>
                <paragraph>To be able to utilize SSL, you first must set your netrhost.conf file with
                    the relevant information to enable SSL connectiions.  These three config
                    options must be set to be able to use SSL, however, sconnect_host if
                    not set will default to 'localhost 127.0.0.1'.</paragraph>
                <literal_block force="False" language="default" linenos="False" xml:space="preserve">sconnect_reip 1         -- This enables the SSL tunnel layer handler within rhost.
sconnect_cmd XYZZY      -- this will set the secret SSL command handshake command to XYZZY.  This is case sensitive and can be up to 31 characters.  Please make sure to only use printable non-whitespace characters.  Ergo: one word
sconnect_host wildcards -- This allows wildcarded sites (one or more) to allow to access the sconnect/stunnel handler.  This defaults to 'localhost' and '127.0.0.1' so if you have 'localhost.localdomain' instead then you must set this to whatever is seen as 'localhost' to you.  You can verify this by checking your /etc/hosts file.</literal_block>
                <note>
                    <paragraph>the sconnect_host is optional.  If you do not specify it, it will default to two values:  'localhost' and '127.0.0.1'.</paragraph>
                </note>
            </section>
            <section ids="running-the-stunnel-setup-program" names="running\ the\ stunnel\ setup\ program">
                <title>Running the stunnel setup program</title>
                <paragraph>At this point you're ready to run the stunnel setup program.  So at this point type the following:</paragraph>
                <literal_block force="False" language="default" linenos="False" xml:space="preserve">./stunnel_setup.sh</literal_block>
                <paragraph>This will prompt you through settings.  Most you can select the defaults to.
                    The SSL port you may need to change based on your administrative requirements.
                    It will prompt you with whatever you set for your mush name.  If you have not
                    selected a mush name at this point, you can select the defaults.</paragraph>
                <paragraph>You will want to use the config file for warpbubble as this hides the secret.</paragraph>
                <paragraph>Be aware that if you have DNS host lookups disabled on your mush, you
                    MUST have 127.0.0.1 as an entry for your sconnect_host file.</paragraph>
            </section>
            <section ids="starting-the-stunnel-proxy" names="starting\ the\ stunnel\ proxy">
                <title>Starting the stunnel proxy</title>
                <paragraph>When you have your stunnel.conf file to the way you want, you then
                    issue the following command to run your SSL layer:</paragraph>
                <literal_block force="False" language="default" linenos="False" xml:space="preserve">./stunnel_start.sh</literal_block>
            </section>
            <section ids="shutting-down-the-stunnel-proxy" names="shutting\ down\ the\ stunnel\ proxy">
                <title>Shutting down the stunnel proxy</title>
                <paragraph>If ever you need to bring down the SSL layer, you may kill it with the command:</paragraph>
                <literal_block force="False" language="default" linenos="False" xml:space="preserve">./stunnel_stop.sh</literal_block>
            </section>
            <section ids="configuring-firewall-on-the-host" names="configuring\ firewall\ on\ the\ host">
                <title>Configuring firewall on the host</title>
                <paragraph>Please be aware that the port that the SSL layer is on must be opened
                    in any firewall rule you specified to allow the connectivity.  This also must
                    not be the port the mush is running on and requires a separate port.</paragraph>
            </section>
        </section>
    </section>
</document>
