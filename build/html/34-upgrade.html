<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#2D2D2D" />
  
  <title>RhostMUSH Handbook :: Updating RhostMUSH prior to 3.9.5p2</title>
  

  <link rel="icon" type="image/png" sizes="32x32" href="_static/img/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="_static/img/favicon-16x16.png">
        <link rel="index" title="Index"
              href="genindex.html"/>

  <link rel="stylesheet" href="_static/css/insegel.css"/>

  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:'',
        VERSION:'',
        LANGUAGE:'None',
        COLLAPSE_INDEX:false,
        FILE_SUFFIX:'.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
    };
  </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>

  <script src="https://email.tl.fortawesome.com/c/eJxNjUEOgyAQAF8jR7Kw6wIHDh7sP1Cw2mgxgmn6-3JsMqc5zEQfE8dkxOY1KKMUOI3ACFKRJpSW2AAp7ontYIaxI6i7XPJVwyeVfCQ550Os3jLrGSNOLgbdAy6s0PBk2TFNjEbsfq31LB0OnX407pJa5v2faRadwSW63mn5KuLyR9j2tgx3zecanl-55R_-jjPs"></script>

</head>

<body>
  <div id="insegel-container">
    <header>
      <div id="logo-container">
          
          <a href="index.html"><img src="_static/img/logo.svg"></a>
          

      </div>
      <div id="project-container">
        <h1>RhostMUSH Handbook Documentation</h1>
      </div>
    </header>

    <div id="content-container">

      <div id="main-content-container">
        <div id="main-content-header">
          <h1>Updating RhostMUSH prior to 3.9.5p2</h1>
        </div>
        <div id="main-content">
          
  <div class="section" id="updating-rhostmush-prior-to-3-9-5p2">
<h1>Updating RhostMUSH prior to 3.9.5p2<a class="headerlink" href="#updating-rhostmush-prior-to-3-9-5p2" title="Permalink to this headline">¶</a></h1>
<p>Ok.</p>
<p>So you’re running an old RhostMUSH.</p>
<p>One prior to 3.9.5p2 and want to take advantage of the new
format of the Makefile and the automated mysql stuff and
all the other goodies that isn’t really (easilly) done
with just patch.sh.</p>
<p>Well, you’re in luck.  It is actually fairly easy to do.</p>
<p>This is what you have to do.</p>
<p>First thing’s first.</p>
<ol class="arabic">
<li><p>Log into your existing mush.  Let’s make current backups
of all your flatfiles.  Issue:
A. &#64;dump/flat
B. wmail/unload
C. &#64;areg/unload
D. newsdb/unload</p></li>
<li><p>Shutdown your game (&#64;shutdown)</p></li>
<li><p>Make an image of all your current backed up files.  From
The Server/game directory you would type:</p>
<blockquote>
<div><p>./backup_flat.sh -s</p>
</div></blockquote>
<p>Please remember the ‘-s’ to the ./backup_flat.sh.</p>
</li>
<li><p>Make note of the most recently created file in the directory
Server/game/oldflat.  It’s usually named something like:</p>
<blockquote>
<div><p>RhostMUSH.dbflat1.tar.gz</p>
</div></blockquote>
<p>You will need this file later.</p>
</li>
<li><p>Rename your ‘Rhost’ directory to something else.  This
is the directory that you have containing the ‘Server’
directory.  Name it anything you want other than ‘Rhost’.
For those not used to unix you would type:</p>
<blockquote>
<div><p>mv Rhost Rhost_old</p>
</div></blockquote>
</li>
<li><dl class="simple">
<dt>Pull in the latest Rhost.  You would type:</dt><dd><p>git clone <a class="reference external" href="https://github.com/RhostMUSH/trunk">https://github.com/RhostMUSH/trunk</a> Rhost</p>
</dd>
</dl>
<p>You would type this in the same directory you have renamed
your old ‘Rhost’ directory</p>
</li>
<li><dl class="simple">
<dt>go into the Rhost/Server directory.   Type:</dt><dd><p>make confsource</p>
</dd>
</dl>
<p>Select what options you want (including the mysql and other goodies)
then compile it (also within the menu, it’s the ‘r’ option).</p>
</li>
</ol>
<dl>
<dt>8   Once your game is compiled and ready to go you need to copy in</dt><dd><p>the data from your old game.  Copy the RhostMUSH.dbflat1.tar.gz
we mentioned in step #4 to the Server/game directory of your NEW
GAME DIRECTORY.  From within the ‘game’ directory of your current
game you should be able to issue (if you named the old one Rhost_old):
Again this needs to be done FROM YOUR Server/game directory!!!
A. cp netrhost.conf netrhost.conf.orig
B. cp ../../Rhost_old/Server/game/RhostMUSH.dbflat1.tar.gz .
C. tar -zxvf RhostMUSH.dbflat1.tar.gz
D. Compare your current netrhost.conf to the default one that came with</p>
<blockquote>
<div><p>the source (that you renamed to netrhost.conf.orig).  Likely the
only sections you have to add to your current netrhost.conf (that
came with your RhostMUSH.dbflat1.tar.gz archive), will be toward
the end, with the include rhost_ingame.conf and rhost_mysql.conf.
Depending on how old your game is coming from you may need to add
more options.  Any config option that is the same between the
netrhost.conf files do not have to be copied over, and you want to
keep your custom settings (like don’t port or other stuff you
have already customized).</p>
</div></blockquote>
<ol class="upperalpha simple" start="5">
<li><p>./db_load data/netrhost.gdbm data/netrhost.db.flat data/netrhost.db.new
This loads in your flatfile information.</p></li>
<li><p>./Startmush
Your ./Startmush should re-index all your txt files you originally made.</p></li>
<li><p>In your game type the following as an immortal or as #1.</p></li>
</ol>
<blockquote>
<div><ol class="arabic simple">
<li><p>wmail/load
This will load in your mail flatfile.</p></li>
<li><p>&#64;areg/load
This will load in your autoregistration flatfile (if available)</p></li>
<li><p>newsdb/load
This will load in your hardcoded bbs flatfile (if available)</p></li>
</ol>
</div></blockquote>
</dd>
</dl>
<ol class="arabic simple" start="9">
<li><p>You should be good to go on a current directory structure for Rhost.  Enjoy!</p></li>
</ol>
<div class="section" id="adding-mysql-to-rhostmush-older-than-3-9-5p2">
<h2>Adding MySQL to RhostMUSH older than 3.9.5p2<a class="headerlink" href="#adding-mysql-to-rhostmush-older-than-3-9-5p2" title="Permalink to this headline">¶</a></h2>
<p>MySQL is now native in RhostMUSH as of 3.9.5p2.</p>
<div class="section" id="important-important-important-important-important-important">
<h3>** IMPORTANT ** IMPORTANT ** IMPORTANT ** IMPORTANT <a href="#id1"><span class="problematic" id="id2">**</span></a>IMPORTANT ** IMPORTANT **<a class="headerlink" href="#important-important-important-important-important-important" title="Permalink to this headline">¶</a></h3>
<p>To autodetect it, YOU MUST HAVE mysql_config installed and running
on your server.  Without this, even if you have mysql db installed
it won’t be able to recognize the parameters you will need for it
and will thus fail.  Please check your linux distribution to see
what packages are needed to install mysql_config.
<strong>***************************************************************************</strong>
** IMPORTANT ** IMPORTANT ** IMPORTANT ** IMPORTANT <strong>IMPORTANT ** IMPORTANT **
*****************************************************************************</strong></p>
<p>Download the git repository to a seperate directory so that you can
copy over the files that it requires you to.</p>
<p>Suggestion:  git clone <a class="reference external" href="http://github.com/RhostMUSH/trunk">http://github.com/RhostMUSH/trunk</a> ~/tmprho</p>
<p>If you are patching UP from an older version, you need to update
the following files:</p>
<ol class="arabic simple">
<li><p>update your src/Makefile to the one in the 3.9.5p2+ repo
( cp ~/tmprho/Server/src/Makefile ~/Rhost/Server/src/Makefile )</p></li>
<li><p>update your bin/asksource.* files to the one in the 3.9.5p2+ repo
( cp ~/tmprho/Server/bin/asksource.* ~/Rhost/Server/bin/ )</p></li>
<li><p>append ‘include rhost_mysql.conf’ BEFORE the rhost_ingame.conf file
and before the section that says ‘define local aliases’ toward the end of
your netrhost.conf file.
( edit your ~/Rhost/Server/game/netrhost.conf file )</p></li>
<li><p>copy the game/rhost_mysql.conf file from the 3.9.5p2+ repo
( cp ~/tmprho/Server/game/rhost_mysql.conf ~/Rhost/Server/game/ )</p></li>
<li><p>The following lines have to be REPLACED/CHANGED in local.c ( toward the top ):
( you may edit this or copy the one from the other distro )
( do either:  edit ~/Rhost/Server/src/local.c )
(        or:  cp ~/tmprho/Server/src/local.c ~/Rhost/Server/src/local.c )</p></li>
</ol>
<dl>
<dt>//———– IF REPLACING/CHANGING local.c COPY BELOW ————————–</dt><dd><dl>
<dt>/* Called when the mush starts up, immediatly prior to the main game</dt><dd><ul class="simple">
<li><p>loop being entered. By this point all databases are loaded and</p></li>
<li><p>all variables configured.</p></li>
</ul>
<p><a href="#id3"><span class="problematic" id="id4">*</span></a>/</p>
</dd>
<dt>#ifdef MYSQL_VERSION</dt><dd><p>extern void local_mysql_init(void);
extern int sql_shutdown(dbref player);</p>
</dd>
</dl>
<p>#endif</p>
<dl class="simple">
<dt>#ifdef SQLITE</dt><dd><p>extern void local_sqlite_init(void);</p>
</dd>
</dl>
<p>#endif /* SQLITE <a href="#id5"><span class="problematic" id="id6">*</span></a>/</p>
<p>void local_startup(void) {
#ifdef SQLITE</p>
<blockquote>
<div><p>local_sqlite_init();</p>
</div></blockquote>
<p>#endif /* SQLITE <a href="#id7"><span class="problematic" id="id8">*</span></a>/
#ifdef MYSQL_VERSION</p>
<blockquote>
<div><p>local_mysql_init();</p>
</div></blockquote>
<dl class="simple">
<dt>#endif</dt><dd><p>load_regexp_functions();</p>
</dd>
</dl>
<p>}</p>
<dl>
<dt>/* Called immediatly after the main game loop exits. At this point</dt><dd><ul class="simple">
<li><p>all databases and variables are still configured</p></li>
</ul>
<p><a href="#id9"><span class="problematic" id="id10">*</span></a>/</p>
</dd>
</dl>
<p>void local_shutdown(void) {
#ifdef MYSQL_VERSION</p>
<blockquote>
<div><p>sql_shutdown(-1);</p>
</div></blockquote>
<p>#endif
}</p>
</dd>
</dl>
<p>//———– IF REPLACING/CHANGING local.c COPY ABOVE ————————–</p>
<ol class="arabic simple" start="6">
<li><p>Issue ‘make clean’ then make confsource to rebuild using the latest
builder script to build in the mysql changes.</p></li>
</ol>
</div>
</div>
</div>


        </div>
      </div>

      <div id="side-menu-container">

        <div id="search" role="search">
        <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
            <input type="text" name="q" placeholder="Search..." />
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
        </form>
</div>

        <div id="side-menu" role="navigation">

          
  
    
  
  
    <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01-intro.html">What RhostMUSH is about and what’s so great about RhostMUSH.</a></li>
<li class="toctree-l1"><a class="reference internal" href="02-compile.html">What to type to Compile and Install RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="03-dbconversion.html">How to convert a database from another mush to RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="04-configure.html">What to type to configure and get your RhostMUSH up and running</a></li>
<li class="toctree-l1"><a class="reference internal" href="05-newmush.html">What to type to get the basics running if you did not choose a pre-existing flatfile</a></li>
<li class="toctree-l1"><a class="reference internal" href="06-security.html">Considerations to locking down restrictions in RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="07-toggles.html">What FLAGS, TOGGLES, POWERS, and DEPOWERS mean in RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="08-lockdown.html">Extended lockdown of the mush and considerations.</a></li>
<li class="toctree-l1"><a class="reference internal" href="09-blocking.html">Methods to block anonymous connections and the pros and cons of doing so</a></li>
<li class="toctree-l1"><a class="reference internal" href="10-customize.html">What may need to be modified to get softcode from PennMUSH, TinyMUSH2, TinyMUSH3, or MUX2 to work on Rhost</a></li>
<li class="toctree-l1"><a class="reference internal" href="11-differences.html">The differences to expect to the end user between PennMUSH, MUX, and RhostMUSH as of 08/06/2016</a></li>
<li class="toctree-l1"><a class="reference internal" href="12-advanced.html">Advanced features of RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="13-signals.html">Signals and why you need them for control</a></li>
<li class="toctree-l1"><a class="reference internal" href="14-ssl.html">Setting up an SSL tunnel for secure connection options</a></li>
<li class="toctree-l1"><a class="reference internal" href="15-bitlevels.html">Multi-tiered bitlevel systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="16-modules.html">Adding hardcoded modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="17-shutdown.html">Shutting down gracefully</a></li>
<li class="toctree-l1"><a class="reference internal" href="18-debug.html">Stack limit and debugging</a></li>
<li class="toctree-l1"><a class="reference internal" href="19-reality.html">Reality levels</a></li>
<li class="toctree-l1"><a class="reference internal" href="20-execscript.html">Execscript and external programs and scripts</a></li>
<li class="toctree-l1"><a class="reference internal" href="21-printf.html">Using printf() for advanced text output</a></li>
<li class="toctree-l1"><a class="reference internal" href="22-ansible.html">Installing using an ansible playbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="23-random.html">Random notes and things to know about RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="24-quickinstall.html">Quickinstall guide to RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="25-godpasswd.html">How to reset the password for #1</a></li>
<li class="toctree-l1"><a class="reference internal" href="26-compileerror.html">Troubleshooting difficulties compiling RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="27-dbcorrupt.html">Dealing with DB Corruption</a></li>
<li class="toctree-l1"><a class="reference internal" href="28-maildbcorrupt.html">Dealing with a corrupt mail database</a></li>
<li class="toctree-l1"><a class="reference internal" href="29-setup.html">Additional simplified notes on setting up RhostMUSH</a></li>
<li class="toctree-l1"><a class="reference internal" href="30-cron.html">Using the built-in cron system for periodically running commands</a></li>
<li class="toctree-l1"><a class="reference internal" href="31-comparison.html">Comparison of features between RhostMUSH, PennMUSH, and MUX2</a></li>
<li class="toctree-l1"><a class="reference internal" href="32-dbloading.html">Loading an existing Database</a></li>
<li class="toctree-l1"><a class="reference internal" href="33-qdbm.html">Converting database betwen GDBM and QDBM</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Updating RhostMUSH prior to 3.9.5p2</a></li>
<li class="toctree-l1"><a class="reference internal" href="requirements.html">Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="windows.html">Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="nda.html">Historical Non-Disclosure Agreement</a></li>
</ul>

  


        </div>

        

      </div>

    </div>

<footer>
    <div id="footer-info">
        <ul id="build-details">
            
                <li class="footer-element">
                    
                        <a href="_sources/34-upgrade.rst.txt" rel="nofollow"> source</a>
                    
                </li>
            

            

            
        </ul>
        <div id="credit">
            created with <a href="http://sphinx-doc.org/">Sphinx</a> and <a href="https://github.com/Autophagy/insegel">Insegel</a>

        </div>
    </div>

    <a id="menu-toggle" class="fa fa-bars" aria-hidden="true"></a>

    <script type="text/javascript">
      $("#menu-toggle").click(function() {
        $("#menu-toggle").toggleClass("toggled");
        $("#side-menu-container").slideToggle(300);
      });
    </script>

</footer> 

</div>

</body>
</html>