{"parents": [], "prev": {"link": "../27-dbcorrupt/", "title": "Dealing with DB Corruption"}, "next": {"link": "../29-setup/", "title": "Additional simplified notes on setting up RhostMUSH"}, "title": "Dealing with a corrupt mail database", "meta": null, "body": "<div class=\"section\" id=\"dealing-with-a-corrupt-mail-database\">\n<h1>Dealing with a corrupt mail database<a class=\"headerlink\" href=\"#dealing-with-a-corrupt-mail-database\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>It says when you try to access mail that mail is disabled and/or off.</p>\n<p>Nothing you do can bring it on line.  Well, this is bad, but not horrible.</p>\n<p>The mail db is totally separate from the main game database.  This means\nthat it in no way damaged or corrupted your main mush database.</p>\n<p>The bad news?  Yes.  Your mail database is corrupt.  To bring it back,\nis it hopes that you read ahead of time about how to backup your mush,\nwhich would include the mail database.</p>\n<div class=\"section\" id=\"backing-up-your-mail-database\">\n<h2>Backing up your mail database<a class=\"headerlink\" href=\"#backing-up-your-mail-database\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>wmail/unload \u2013 this flatfile dumps your mail db.  You should run it daily.</p>\n<p>To recover your mail, it assumes you have a mail flatfile in either the\n~/Server/game/data directory or the ~/Server/game/prevflat directory.  The\nlatter directory is used in junction to the backup_flat.sh and will always\nhouse the latest flatfile if not one recently dumped in your data directory.</p>\n</div>\n<div class=\"section\" id=\"automatically-recovering-your-mail-database\">\n<h2>Automatically recovering your mail database<a class=\"headerlink\" href=\"#automatically-recovering-your-mail-database\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>wmail/load</p>\n<p>Yup, that\u2019s it.  It\u2019ll take care of everything else.  Isn\u2019t automation grand?</p>\n<p>Doesn\u2019t even require a reboot :)</p>\n<dl class=\"simple\">\n<dt>NOTE:  You may at this point wish to run the following:</dt><dd><p>wmail/fix  \u2013 this fixes the mail database and sync\u2019s it to the mush db.\nwmail/lfix \u2013 this loads in the fixed mail database</p>\n</dd>\n</dl>\n<p>If you have a very old mail database, this is likely going to be required\nto sync against nuked players and other changes to the game since the flatfile.</p>\n<p>If this is a new db that you have, you can skip the fixing.</p>\n</div>\n<div class=\"section\" id=\"manually-recovering-your-mail-database\">\n<h2>Manually recovering your mail database<a class=\"headerlink\" href=\"#manually-recovering-your-mail-database\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>To recover your mail manually, you need to delete your mail databases,\nreboot, then reload your mail flatfiles.  If you have no mail flatfiles,\nwell, you\u2019re going to have to start over with the mail database.  Sorry.</p>\n<p>First, go into the \u2018game\u2019 subdirectory.  Inside that directory is a \u2018data\u2019\ndirectory.</p>\n<p>You will be deleting all the files with the following names:</p>\n<p>RhostMUSH.mail.*                (like RhostMUSH.mail.dir/RhostMUSH.mail.pag)\nRhostMUSH.folder.*              (like RhostMUSH.folder.dir/RhostMUSH.folder.pag)</p>\n<p>DO NOT DELETE OTHER NAMED FILES!!!</p>\n<p>Once these files are deleted, you may issue a &#64;reboot to restart the mush.\nThis will unlock the mail system and load in a fresh db.</p>\n<p>Now, if you have flatfiles of the old mail database, you will see in either\nthe \u2018data\u2019 directory or the \u2018prevflat\u2019 directory files that are called:</p>\n<p>RhostMUSH.dump.folder\nRhostMUSH.dump.mail</p>\n<p>Make sure these two files are in the \u2018data\u2019 subdirectory.  Copy them in\nif they exist in your \u2018prevflat\u2019 directory.</p>\n<p>Once they are in the \u2018data\u2019 directory, within the mush type: wmail/load</p>\n<p>This loads in the flatfile and recover the mail database.</p>\n<p>Now, at this point the mail db may not be 100% in-sync with the game db.</p>\n<p>So let\u2019s fix it.</p>\n<p>wmail/fix   \u2013 this will run a fix on the mail db and repair any issues.</p>\n<p>wmail/lfix  \u2013 this will load the fixed flatfile back into the mush.</p>\n<p>At this point you should be good to go.</p>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["29-setup", "Additional simplified notes on setting up RhostMUSH", "N", "next"], ["27-dbcorrupt", "Dealing with DB Corruption", "P", "previous"]], "sourcename": "28-maildbcorrupt.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Dealing with a corrupt mail database</a><ul>\n<li><a class=\"reference internal\" href=\"#backing-up-your-mail-database\">Backing up your mail database</a></li>\n<li><a class=\"reference internal\" href=\"#automatically-recovering-your-mail-database\">Automatically recovering your mail database</a></li>\n<li><a class=\"reference internal\" href=\"#manually-recovering-your-mail-database\">Manually recovering your mail database</a></li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "28-maildbcorrupt", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12", "insegel_version": "1.1.0"}