{"parents": [], "prev": {"link": "../33-qdbm/", "title": "Converting database betwen GDBM and QDBM"}, "next": {"link": "../35-txtfiles/", "title": "Textfiles for RhostMUSH"}, "title": "Updating RhostMUSH prior to 3.9.5p2", "meta": null, "body": "<div class=\"section\" id=\"updating-rhostmush-prior-to-3-9-5p2\">\n<h1>Updating RhostMUSH prior to 3.9.5p2<a class=\"headerlink\" href=\"#updating-rhostmush-prior-to-3-9-5p2\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Ok.</p>\n<p>So you\u2019re running an old RhostMUSH.</p>\n<p>One prior to 3.9.5p2 and want to take advantage of the new\nformat of the Makefile and the automated mysql stuff and\nall the other goodies that isn\u2019t really (easilly) done\nwith just patch.sh.</p>\n<p>Well, you\u2019re in luck.  It is actually fairly easy to do.</p>\n<p>This is what you have to do.</p>\n<p>First thing\u2019s first.</p>\n<ol class=\"arabic\">\n<li><p>Log into your existing mush.  Let\u2019s make current backups\nof all your flatfiles.  Issue:\nA. &#64;dump/flat\nB. wmail/unload\nC. &#64;areg/unload\nD. newsdb/unload</p></li>\n<li><p>Shutdown your game (&#64;shutdown)</p></li>\n<li><p>Make an image of all your current backed up files.  From\nThe Server/game directory you would type:</p>\n<blockquote>\n<div><p>./backup_flat.sh -s</p>\n</div></blockquote>\n<p>Please remember the \u2018-s\u2019 to the ./backup_flat.sh.</p>\n</li>\n<li><p>Make note of the most recently created file in the directory\nServer/game/oldflat.  It\u2019s usually named something like:</p>\n<blockquote>\n<div><p>RhostMUSH.dbflat1.tar.gz</p>\n</div></blockquote>\n<p>You will need this file later.</p>\n</li>\n<li><p>Rename your \u2018Rhost\u2019 directory to something else.  This\nis the directory that you have containing the \u2018Server\u2019\ndirectory.  Name it anything you want other than \u2018Rhost\u2019.\nFor those not used to unix you would type:</p>\n<blockquote>\n<div><p>mv Rhost Rhost_old</p>\n</div></blockquote>\n</li>\n<li><dl class=\"simple\">\n<dt>Pull in the latest Rhost.  You would type:</dt><dd><p>git clone <a class=\"reference external\" href=\"https://github.com/RhostMUSH/trunk\">https://github.com/RhostMUSH/trunk</a> Rhost</p>\n</dd>\n</dl>\n<p>You would type this in the same directory you have renamed\nyour old \u2018Rhost\u2019 directory</p>\n</li>\n<li><dl class=\"simple\">\n<dt>go into the Rhost/Server directory.   Type:</dt><dd><p>make confsource</p>\n</dd>\n</dl>\n<p>Select what options you want (including the mysql and other goodies)\nthen compile it (also within the menu, it\u2019s the \u2018r\u2019 option).</p>\n</li>\n</ol>\n<dl>\n<dt>8   Once your game is compiled and ready to go you need to copy in</dt><dd><p>the data from your old game.  Copy the RhostMUSH.dbflat1.tar.gz\nwe mentioned in step #4 to the Server/game directory of your NEW\nGAME DIRECTORY.  From within the \u2018game\u2019 directory of your current\ngame you should be able to issue (if you named the old one Rhost_old):\nAgain this needs to be done FROM YOUR Server/game directory!!!\nA. cp netrhost.conf netrhost.conf.orig\nB. cp ../../Rhost_old/Server/game/RhostMUSH.dbflat1.tar.gz .\nC. tar -zxvf RhostMUSH.dbflat1.tar.gz\nD. Compare your current netrhost.conf to the default one that came with</p>\n<blockquote>\n<div><p>the source (that you renamed to netrhost.conf.orig).  Likely the\nonly sections you have to add to your current netrhost.conf (that\ncame with your RhostMUSH.dbflat1.tar.gz archive), will be toward\nthe end, with the include rhost_ingame.conf and rhost_mysql.conf.\nDepending on how old your game is coming from you may need to add\nmore options.  Any config option that is the same between the\nnetrhost.conf files do not have to be copied over, and you want to\nkeep your custom settings (like don\u2019t port or other stuff you\nhave already customized).</p>\n</div></blockquote>\n<ol class=\"upperalpha simple\" start=\"5\">\n<li><p>./db_load data/netrhost.gdbm data/netrhost.db.flat data/netrhost.db.new\nThis loads in your flatfile information.</p></li>\n<li><p>./Startmush\nYour ./Startmush should re-index all your txt files you originally made.</p></li>\n<li><p>In your game type the following as an immortal or as #1.</p></li>\n</ol>\n<blockquote>\n<div><ol class=\"arabic simple\">\n<li><p>wmail/load\nThis will load in your mail flatfile.</p></li>\n<li><p>&#64;areg/load\nThis will load in your autoregistration flatfile (if available)</p></li>\n<li><p>newsdb/load\nThis will load in your hardcoded bbs flatfile (if available)</p></li>\n</ol>\n</div></blockquote>\n</dd>\n</dl>\n<ol class=\"arabic simple\" start=\"9\">\n<li><p>You should be good to go on a current directory structure for Rhost.  Enjoy!</p></li>\n</ol>\n<div class=\"section\" id=\"adding-mysql-to-rhostmush-older-than-3-9-5p2\">\n<h2>Adding MySQL to RhostMUSH older than 3.9.5p2<a class=\"headerlink\" href=\"#adding-mysql-to-rhostmush-older-than-3-9-5p2\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>MySQL is now native in RhostMUSH as of 3.9.5p2.</p>\n<div class=\"section\" id=\"important-important-important-important-important-important\">\n<h3>** IMPORTANT ** IMPORTANT ** IMPORTANT ** IMPORTANT <a href=\"#id1\"><span class=\"problematic\" id=\"id2\">**</span></a>IMPORTANT ** IMPORTANT **<a class=\"headerlink\" href=\"#important-important-important-important-important-important\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>To autodetect it, YOU MUST HAVE mysql_config installed and running\non your server.  Without this, even if you have mysql db installed\nit won\u2019t be able to recognize the parameters you will need for it\nand will thus fail.  Please check your linux distribution to see\nwhat packages are needed to install mysql_config.\n<strong>***************************************************************************</strong>\n** IMPORTANT ** IMPORTANT ** IMPORTANT ** IMPORTANT <strong>IMPORTANT ** IMPORTANT **\n*****************************************************************************</strong></p>\n<p>Download the git repository to a seperate directory so that you can\ncopy over the files that it requires you to.</p>\n<p>Suggestion:  git clone <a class=\"reference external\" href=\"http://github.com/RhostMUSH/trunk\">http://github.com/RhostMUSH/trunk</a> ~/tmprho</p>\n<p>If you are patching UP from an older version, you need to update\nthe following files:</p>\n<ol class=\"arabic simple\">\n<li><p>update your src/Makefile to the one in the 3.9.5p2+ repo\n( cp ~/tmprho/Server/src/Makefile ~/Rhost/Server/src/Makefile )</p></li>\n<li><p>update your bin/asksource.* files to the one in the 3.9.5p2+ repo\n( cp ~/tmprho/Server/bin/asksource.* ~/Rhost/Server/bin/ )</p></li>\n<li><p>append \u2018include rhost_mysql.conf\u2019 BEFORE the rhost_ingame.conf file\nand before the section that says \u2018define local aliases\u2019 toward the end of\nyour netrhost.conf file.\n( edit your ~/Rhost/Server/game/netrhost.conf file )</p></li>\n<li><p>copy the game/rhost_mysql.conf file from the 3.9.5p2+ repo\n( cp ~/tmprho/Server/game/rhost_mysql.conf ~/Rhost/Server/game/ )</p></li>\n<li><p>The following lines have to be REPLACED/CHANGED in local.c ( toward the top ):\n( you may edit this or copy the one from the other distro )\n( do either:  edit ~/Rhost/Server/src/local.c )\n(        or:  cp ~/tmprho/Server/src/local.c ~/Rhost/Server/src/local.c )</p></li>\n</ol>\n<dl>\n<dt>//\u2014\u2014\u2014\u2013 IF REPLACING/CHANGING local.c COPY BELOW \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2013</dt><dd><dl>\n<dt>/* Called when the mush starts up, immediatly prior to the main game</dt><dd><ul class=\"simple\">\n<li><p>loop being entered. By this point all databases are loaded and</p></li>\n<li><p>all variables configured.</p></li>\n</ul>\n<p><a href=\"#id3\"><span class=\"problematic\" id=\"id4\">*</span></a>/</p>\n</dd>\n<dt>#ifdef MYSQL_VERSION</dt><dd><p>extern void local_mysql_init(void);\nextern int sql_shutdown(dbref player);</p>\n</dd>\n</dl>\n<p>#endif</p>\n<dl class=\"simple\">\n<dt>#ifdef SQLITE</dt><dd><p>extern void local_sqlite_init(void);</p>\n</dd>\n</dl>\n<p>#endif /* SQLITE <a href=\"#id5\"><span class=\"problematic\" id=\"id6\">*</span></a>/</p>\n<p>void local_startup(void) {\n#ifdef SQLITE</p>\n<blockquote>\n<div><p>local_sqlite_init();</p>\n</div></blockquote>\n<p>#endif /* SQLITE <a href=\"#id7\"><span class=\"problematic\" id=\"id8\">*</span></a>/\n#ifdef MYSQL_VERSION</p>\n<blockquote>\n<div><p>local_mysql_init();</p>\n</div></blockquote>\n<dl class=\"simple\">\n<dt>#endif</dt><dd><p>load_regexp_functions();</p>\n</dd>\n</dl>\n<p>}</p>\n<dl>\n<dt>/* Called immediatly after the main game loop exits. At this point</dt><dd><ul class=\"simple\">\n<li><p>all databases and variables are still configured</p></li>\n</ul>\n<p><a href=\"#id9\"><span class=\"problematic\" id=\"id10\">*</span></a>/</p>\n</dd>\n</dl>\n<p>void local_shutdown(void) {\n#ifdef MYSQL_VERSION</p>\n<blockquote>\n<div><p>sql_shutdown(-1);</p>\n</div></blockquote>\n<p>#endif\n}</p>\n</dd>\n</dl>\n<p>//\u2014\u2014\u2014\u2013 IF REPLACING/CHANGING local.c COPY ABOVE \u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2014\u2013</p>\n<ol class=\"arabic simple\" start=\"6\">\n<li><p>Issue \u2018make clean\u2019 then make confsource to rebuild using the latest\nbuilder script to build in the mysql changes.</p></li>\n</ol>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["35-txtfiles", "Textfiles for RhostMUSH", "N", "next"], ["33-qdbm", "Converting database betwen GDBM and QDBM", "P", "previous"]], "sourcename": "34-upgrade.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Updating RhostMUSH prior to 3.9.5p2</a><ul>\n<li><a class=\"reference internal\" href=\"#adding-mysql-to-rhostmush-older-than-3-9-5p2\">Adding MySQL to RhostMUSH older than 3.9.5p2</a><ul>\n<li><a class=\"reference internal\" href=\"#important-important-important-important-important-important\">** IMPORTANT ** IMPORTANT ** IMPORTANT ** IMPORTANT **IMPORTANT ** IMPORTANT **</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "34-upgrade", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12", "insegel_version": "1.1.0"}