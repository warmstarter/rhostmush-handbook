{"parents": [], "prev": {"link": "../26-compileerror/", "title": "Troubleshooting difficulties compiling RhostMUSH"}, "next": {"link": "../28-maildbcorrupt/", "title": "Dealing with a corrupt mail database"}, "title": "Dealing with DB Corruption", "meta": null, "body": "<div class=\"section\" id=\"dealing-with-db-corruption\">\n<h1>Dealing with DB Corruption<a class=\"headerlink\" href=\"#dealing-with-db-corruption\" title=\"Permalink to this headline\">\u00b6</a></h1>\n<p>Ok.  Your database won\u2019t come up.</p>\n<p>If you are reading this, then likely the scenerio is one of the following:</p>\n<ol class=\"arabic simple\">\n<li><p>The mush says it can\u2019t find your database files.</p></li>\n<li><p>The mush says it can\u2019t read or load your database files.</p></li>\n<li><p>The mush seems to load fine but I can\u2019t log in anyone and when I do\nall the names and attributes of things seem to be gone!</p></li>\n<li><p>Bringing up your mail database</p></li>\n</ol>\n<p>First thing is first.  Don\u2019t have a panic attack.</p>\n<div class=\"section\" id=\"if-the-mush-says-it-can-t-find-your-database-files\">\n<h2>If the mush says it can\u2019t find your database files<a class=\"headerlink\" href=\"#if-the-mush-says-it-can-t-find-your-database-files\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<div class=\"section\" id=\"check-the-names-of-the-database-files-in-your-data-directory\">\n<h3>Check the names of the database files in your \u2018data\u2019 directory<a class=\"headerlink\" href=\"#check-the-names-of-the-database-files-in-your-data-directory\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>They should be named something like:\nnetrhost.db\nnetrhost.db.old\nnetrhost.db.old.prev\nnetrhost.gdbm.dir\nnetrhost.gdbm.pag</p>\n<p>And you may see a netrhost.db.flat</p>\n</div>\n<div class=\"section\" id=\"check-your-netrhost-conf-file\">\n<h3>Check your netrhost.conf file<a class=\"headerlink\" href=\"#check-your-netrhost-conf-file\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you never touched the <a href=\"#id1\"><span class=\"problematic\" id=\"id2\">*</span></a>database or muddb_name params, you should be good.</p>\n<p>Verify your <a href=\"#id3\"><span class=\"problematic\" id=\"id4\">*</span></a>database params (and muddb_name) are still set to \u2018netrhost\u2019 as\npart of the name.  Ergo, the default values and you didn\u2019t change them.\nThese should match up with the filenames in your data directory.</p>\n<p>If these names do not match up, it can\u2019t find the database files to load.\nSo you shouldn\u2019t have to change these names, ever. :)</p>\n</div>\n<div class=\"section\" id=\"check-your-mush-config-file\">\n<h3>Check your mush.config file<a class=\"headerlink\" href=\"#check-your-mush-config-file\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you never modified this file, you should be good.</p>\n<p>The gamename should be \u2018netrhost\u2019 for this file.  This does NOT control\nthe name of your game.  This controls the name of all the files\nas associated to the mush.  So changing this means the netrhost.conf\nfile, all your database files, and so forth.  Please don\u2019t change this :)</p>\n</div>\n</div>\n<div class=\"section\" id=\"if-the-mush-says-it-can-t-read-or-load-your-database-files\">\n<h2>If the mush says it can\u2019t read or load your database files<a class=\"headerlink\" href=\"#if-the-mush-says-it-can-t-read-or-load-your-database-files\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Double check everything for the previous issue. Make sure everything is named properly.</p>\n<div class=\"section\" id=\"verify-you-have-enough-disk-space-quota\">\n<h3>Verify you have enough disk space. (quota)<a class=\"headerlink\" href=\"#verify-you-have-enough-disk-space-quota\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Some account have a limited quota to run in.  If you reached or exceed\nyour disk quota, you can have a corrupted database.  So always keep\nyour eye on the size.  quota -s to see a human readable format to see\nhow much quota you have left.  You want to make sure current in use is\nbelow the \u2018grace\u2019 and soft/hard limits shown.  If not, you\u2019re out of\nspace.</p>\n<p>You will need to remove some files before you repair and bring up your\nmush again.  Try to keep your quota at least 200 megs free to allow\nplenty of wonderful growth space for the mush.</p>\n</div>\n<div class=\"section\" id=\"verify-you-have-enough-disk-space-system\">\n<h3>Verify you have enough disk space.  (system)<a class=\"headerlink\" href=\"#verify-you-have-enough-disk-space-system\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>The second way you can run out of disk space is by the filesystem itself.\ndo a df -h . in your \u2018game\u2019 directory\u2019.  That is df -h &lt;period&gt;.\nThis will return how much disk space is being used and how much remains.\nIf it shows 100% used, you\u2019re out of disk space and the db is corrupt.</p>\n<p>At this point, you\u2019re pretty screwed.  You can see if anything exists\nin your system to free up some space, but if the filesystem itself\nis filled, reach out to the owner of the server and let them know.\nIt\u2019s a much bigger deal than just your mush if that\u2019s the case.</p>\n<p>Until this issue is resolved, you can not repair and bring up your mush.\nNo disk to run the game.</p>\n</div>\n</div>\n<div class=\"section\" id=\"if-the-mush-seems-to-load-fine-but-i-can-t-log-in-anyone-and-when-i-do-all-the-names-and-attributes-of-things-seem-to-be-gone\">\n<h2>If the mush seems to load fine but I can\u2019t log in anyone and when I do all the names and attributes of things seem to be gone!<a class=\"headerlink\" href=\"#if-the-mush-seems-to-load-fine-but-i-can-t-log-in-anyone-and-when-i-do-all-the-names-and-attributes-of-things-seem-to-be-gone\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Ok, at this point you likely had your mush up when the physical server\nwent down hard.  Weither through an emergency shutdown or a physical\npower outage, your db likely was brought down hard during a write,\nso it left it in a corrupt state.  These things happen.  This is\nwhy we always strongly request you make daily flatfile dumps.</p>\n<p>So, to recover your database.</p>\n<div class=\"section\" id=\"the-bad-news\">\n<h3>The bad news<a class=\"headerlink\" href=\"#the-bad-news\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you have no flatfile backup or never bothered with backups?\nI\u2019m sorry, at this point you\u2019re SOA.  There\u2019s no easy way to\nrecover a corrupted binary database.  If you absolutely need\ndata out of it we may be able to help you to piece meal things\nout of it, but otherwise it\u2019s a lost cause.  You\u2019ll have to start\nover from scratch.  I\u2019m sorry.</p>\n</div>\n<div class=\"section\" id=\"the-good-news\">\n<h3>The good news<a class=\"headerlink\" href=\"#the-good-news\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>If you made backups, or if the server had a normal shutdown, you\nlikely have a flatfile backup.  You will see a netrhost.db.flat\nin either the \u2018data\u2019 directory or \u2018prevflat\u2019 directory.  That\nis your manual flatfile backup.</p>\n<p>If the server had a normal shutdown, you will see a file called\nnetrhost.db.TERMFLAT.  This is a scram-emergency db flatfile.\nIt attempts to write this at the time of server shutdown to\nhopefully keep a clean backup in the case of issues since\nit identifies the server is coming down hard.  Make sure\nif you plan to use the TERMFLAT as your recovery flatfile\nthat the very last line shows something like ** END OF DUMP <a href=\"#id5\"><span class=\"problematic\" id=\"id6\">**</span></a>.\nThat shows you had a successful backup.</p>\n</div>\n<div class=\"section\" id=\"now-to-restore-your-database\">\n<h3>Now, to restore your database?<a class=\"headerlink\" href=\"#now-to-restore-your-database\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<p>Please refer to the file \u2018README.DBLOADING\u2019.</p>\n</div>\n</div>\n<div class=\"section\" id=\"bringing-up-your-mail-database\">\n<h2>Bringing up your mail database<a class=\"headerlink\" href=\"#bringing-up-your-mail-database\" title=\"Permalink to this headline\">\u00b6</a></h2>\n<p>Your mail db may or may not come up at this point.</p>\n<div class=\"section\" id=\"if-after-restoring-main-database-your-mail-database-works\">\n<h3>If after restoring main database your mail database works<a class=\"headerlink\" href=\"#if-after-restoring-main-database-your-mail-database-works\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<dl class=\"simple\">\n<dt>If your mail database came up and does not show</dt><dd><p>\u2018Mail: mail is currently off\u2019 then you should be good to go.</p>\n</dd>\n</dl>\n<p>Please issue:\nwmail/fix\nwmail/lfix</p>\n<p>This will put your mail system in sync with your current database and\nfix up any errors that may exist.  wmail/fix fixes the mail, wmail/lfix\nloads in the fixes.</p>\n</div>\n<div class=\"section\" id=\"if-after-restoring-main-database-your-mail-database-does-not-work\">\n<h3>If after restoring main database your mail database does not work<a class=\"headerlink\" href=\"#if-after-restoring-main-database-your-mail-database-does-not-work\" title=\"Permalink to this headline\">\u00b6</a></h3>\n<blockquote>\n<div><dl class=\"simple\">\n<dt>If your mail database is not up and shows</dt><dd><p>\u2018Mail: mail is currently off\u2019 then your mail db is currupt.</p>\n</dd>\n</dl>\n</div></blockquote>\n<p>To fix your mail db please refer to file \u2018README.MAILCANNOTLOAD\u2019</p>\n</div>\n</div>\n</div>\n", "metatags": "", "rellinks": [["genindex", "General Index", "I", "index"], ["28-maildbcorrupt", "Dealing with a corrupt mail database", "N", "next"], ["26-compileerror", "Troubleshooting difficulties compiling RhostMUSH", "P", "previous"]], "sourcename": "27-dbcorrupt.rst.txt", "toc": "<ul>\n<li><a class=\"reference internal\" href=\"#\">Dealing with DB Corruption</a><ul>\n<li><a class=\"reference internal\" href=\"#if-the-mush-says-it-can-t-find-your-database-files\">If the mush says it can\u2019t find your database files</a><ul>\n<li><a class=\"reference internal\" href=\"#check-the-names-of-the-database-files-in-your-data-directory\">Check the names of the database files in your \u2018data\u2019 directory</a></li>\n<li><a class=\"reference internal\" href=\"#check-your-netrhost-conf-file\">Check your netrhost.conf file</a></li>\n<li><a class=\"reference internal\" href=\"#check-your-mush-config-file\">Check your mush.config file</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#if-the-mush-says-it-can-t-read-or-load-your-database-files\">If the mush says it can\u2019t read or load your database files</a><ul>\n<li><a class=\"reference internal\" href=\"#verify-you-have-enough-disk-space-quota\">Verify you have enough disk space. (quota)</a></li>\n<li><a class=\"reference internal\" href=\"#verify-you-have-enough-disk-space-system\">Verify you have enough disk space.  (system)</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#if-the-mush-seems-to-load-fine-but-i-can-t-log-in-anyone-and-when-i-do-all-the-names-and-attributes-of-things-seem-to-be-gone\">If the mush seems to load fine but I can\u2019t log in anyone and when I do all the names and attributes of things seem to be gone!</a><ul>\n<li><a class=\"reference internal\" href=\"#the-bad-news\">The bad news</a></li>\n<li><a class=\"reference internal\" href=\"#the-good-news\">The good news</a></li>\n<li><a class=\"reference internal\" href=\"#now-to-restore-your-database\">Now, to restore your database?</a></li>\n</ul>\n</li>\n<li><a class=\"reference internal\" href=\"#bringing-up-your-mail-database\">Bringing up your mail database</a><ul>\n<li><a class=\"reference internal\" href=\"#if-after-restoring-main-database-your-mail-database-works\">If after restoring main database your mail database works</a></li>\n<li><a class=\"reference internal\" href=\"#if-after-restoring-main-database-your-mail-database-does-not-work\">If after restoring main database your mail database does not work</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n", "display_toc": true, "page_source_suffix": ".rst", "current_page_name": "27-dbcorrupt", "sidebars": ["localtoc.html", "relations.html", "sourcelink.html", "searchbox.html"], "customsidebar": null, "alabaster_version": "0.7.12", "insegel_version": "1.1.0"}